# .gitignore

```

*.pyc
__pycache__/
db.sqlite3
.env
*.log
/static/
/media/
.DS_Store
.vscode/
```

# db.sqlite3

This is a binary file of the type: Binary

# manage.py

```py
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'trainer_timetable.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

```

# timetable_app\__init__.py

```py

```

# timetable_app\admin.py

```py
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from django.contrib.auth.forms import UserCreationForm, UserChangeForm
from .models import Member, Trainer, Utilization

# Custom form for creating a new Member
class MemberCreationForm(UserCreationForm):
    class Meta:
        model = Member
        fields = ('email',)

    def save(self, commit=True):
        user = super().save(commit=False)
        user.set_password(self.cleaned_data["password1"])
        if commit:
            user.save()
        return user

# Custom form for changing an existing Member
class MemberChangeForm(UserChangeForm):
    class Meta:
        model = Member
        fields = ('email', 'is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions')

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # Make the password field read-only
        self.fields['password'].widget.attrs['readonly'] = True

    def save(self, commit=True):
        user = super().save(commit=False)
        password = self.cleaned_data.get("password")
        # Only hash if password changed and not already hashed
        if password and password != user.password:
            user.set_password(password)
        if commit:
            user.save()
        return user

# Custom admin for Member
class MemberAdmin(UserAdmin):
    add_form = MemberCreationForm
    form = MemberChangeForm
    model = Member
    list_display = ('email', 'is_staff', 'is_active')
    list_filter = ('is_staff', 'is_active', 'is_superuser')
    fieldsets = (
        (None, {'fields': ('email', 'password')}),
        ('Permissions', {'fields': ('is_staff', 'is_active', 'is_superuser', 'groups', 'user_permissions')}),
    )
    add_fieldsets = (
        (None, {
            'classes': ('wide',),
            'fields': ('email', 'password1', 'password2', 'is_staff', 'is_active', 'is_superuser')}
        ),
    )
    search_fields = ('email',)
    ordering = ('email',)

# Register models
admin.site.register(Member, MemberAdmin)
admin.site.register(Trainer)
admin.site.register(Utilization)




```

# timetable_app\apps.py

```py
from django.apps import AppConfig


class TimetableAppConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'timetable_app'

```

# timetable_app\migrations\__init__.py

```py

```

# timetable_app\migrations\0001_initial.py

```py
# Generated by Django 5.2.1 on 2025-07-04 21:37

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='Member',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_staff', models.BooleanField(default=False)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to.', related_name='member_groups', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='member_permissions', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Trainer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='trainer', to='timetable_app.member')),
            ],
        ),
        migrations.CreateModel(
            name='Utilization',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('course_name', models.CharField(max_length=255)),
                ('session_date', models.DateField()),
                ('start_time', models.TimeField()),
                ('end_time', models.TimeField()),
                ('location', models.CharField(blank=True, max_length=255, null=True)),
                ('trainer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='timetable_app.trainer')),
            ],
        ),
    ]

```

# timetable_app\migrations\0002_alter_member_password.py

```py
# Generated by Django 5.2.1 on 2025-07-05 23:28

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('timetable_app', '0001_initial'),
    ]

    operations = [
        migrations.AlterField(
            model_name='member',
            name='password',
            field=models.CharField(max_length=128),
        ),
    ]

```

# timetable_app\models.py

```py
# Django models for a training timetable application
from django.db import models
from django.contrib.auth.models import AbstractBaseUser, PermissionsMixin, BaseUserManager, Group, Permission

class MemberManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        if not email:
            raise ValueError('The Email field must be set')
        email = self.normalize_email(email)
        user = self.model(email=email, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        return self.create_user(email, password, **extra_fields)

class Member(AbstractBaseUser, PermissionsMixin):
    email = models.EmailField(unique=True)
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False)
    password = models.CharField(max_length=128)

    objects = MemberManager()

    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = []

    # Override groups with a unique related_name
    groups = models.ManyToManyField(
        Group,
        related_name='member_groups',  # Unique reverse accessor
        blank=True,
        verbose_name='groups',
        help_text='The groups this user belongs to.',
    )

    # Override user_permissions with a unique related_name
    user_permissions = models.ManyToManyField(
        Permission,
        related_name='member_permissions',  # Unique reverse accessor
        blank=True,
        verbose_name='user permissions',
        help_text='Specific permissions for this user.',
    )

    def __str__(self):
        return self.email

class Trainer(models.Model):
    user = models.OneToOneField(Member, on_delete=models.CASCADE, related_name='trainer')
    name = models.CharField(max_length=255)

    def __str__(self):
        return self.name

class Utilization(models.Model):
    trainer = models.ForeignKey(Trainer, on_delete=models.CASCADE)
    course_name = models.CharField(max_length=255)
    session_date = models.DateField()
    start_time = models.TimeField()
    end_time = models.TimeField()
    location = models.CharField(max_length=255, null=True, blank=True)

    def __str__(self):
        return f"{self.course_name} on {self.session_date}"
```

# timetable_app\templates\calendar.html

```html
<!DOCTYPE html>
<html>
<head>
    <title>Trainer Schedule</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <style>
        .highlight-event {
            background-color: #ffcc00 !important;
            border-color: #ff9900 !important;
        }
        .calendar-container {
            display: flex;
            justify-content: center;
        }
        .fc-popover {
            z-index: 9999 !important;
        }
        /* Dark mode styles */
        body.dark-mode {
            background-color: #181818 !important;
            color: #eee !important;
        }
        body.dark-mode .card, body.dark-mode .fc-tooltip {
            background: #23272b !important;
            color: #eee !important;
            border-color: #444 !important;
        }
        body.dark-mode .fc {
            background: #23272b !important;
            color: #eee !important;
        }
        body.dark-mode .fc-toolbar-title,
        body.dark-mode .fc-button,
        body.dark-mode .fc-col-header-cell,
        body.dark-mode .fc-daygrid-day-number {
            color: #eee !important;
        }
        body.dark-mode .fc-button-primary {
            background-color: #444 !important;
            border-color: #666 !important;
        }
        body.dark-mode .fc-button-primary:not(:disabled):active,
        body.dark-mode .fc-button-primary:not(:disabled).fc-button-active {
            background-color: #666 !important;
            border-color: #888 !important;
        }
        .top-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container mt-3 calendar-container">
        <div style="width:100%;">
            <div class="top-bar">
                <button id="toggle-dark" class="btn btn-dark" title="Toggle dark mode">üåô</button>
                <a href="{% url 'logout' %}" class="btn btn-secondary">Logout</a>
                {% if request.user.is_superuser %}
                    <a href="{% url 'admin_schedule' %}" class="btn btn-primary">Admin Schedule</a>
                {% endif %}
            </div>
            <h2>Your Schedule</h2>
            {% if error %}
                <p class="text-danger">{{ error }}</p>
            {% else %}
                <div id="calendar"></div>
                {{ events|json_script:"events-data" }}
            {% endif %}
        </div>
    </div>
    {% if not error %}
    <script>
        // Dark mode persistence and icon
        function setDarkMode(on) {
            if (on) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'on');
                document.getElementById('toggle-dark').innerText = '‚òÄÔ∏è';
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'off');
                document.getElementById('toggle-dark').innerText = 'üåô';
            }
        }
        // On page load, set dark mode if needed
        if (localStorage.getItem('darkMode') === 'on') {
            setDarkMode(true);
        } else {
            setDarkMode(false);
        }
        document.getElementById('toggle-dark').onclick = function() {
            setDarkMode(!document.body.classList.contains('dark-mode'));
        };

        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var eventsDataElement = document.getElementById('events-data');
            if (eventsDataElement) {
                var eventsData = JSON.parse(eventsDataElement.textContent);

                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    views: {
                        dayGridMonth: { buttonText: 'Month' },
                        timeGridWeek: { buttonText: 'Week' },
                        timeGridDay: { buttonText: 'Day' }
                    },
                    events: eventsData,
                    timeZone: 'Asia/Kolkata',
                    eventMouseEnter: function(info) {
                        // Show Bootstrap tooltip with summary
                        var summary = info.event.extendedProps.summary || '';
                        var tooltip = document.createElement('div');
                        tooltip.className = 'fc-tooltip card p-2 shadow';
                        tooltip.style.position = 'absolute';
                        tooltip.style.zIndex = 10000;
                        tooltip.innerText = summary;
                        document.body.appendChild(tooltip);

                        function moveTooltip(e) {
                            tooltip.style.left = (e.pageX + 10) + 'px';
                            tooltip.style.top = (e.pageY + 10) + 'px';
                        }
                        info.el.addEventListener('mousemove', moveTooltip);
                        info.el.addEventListener('mouseleave', function() {
                            tooltip.remove();
                            info.el.removeEventListener('mousemove', moveTooltip);
                        });
                    },
                    eventClassNames: function(info) {
                        return info.event.extendedProps.highlight ? ['highlight-event'] : [];
                    },
                    nowIndicator: true // Show current time indicator
                });
                calendar.render();
            } else {
                console.error("Events data element not found");
            }
        });
    </script>
    {% endif %}
</body>
</html>
```

# timetable_app\templates\login.html

```html
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body.dark-mode {
            background-color: #181818 !important;
            color: #eee !important;
        }
        .card {
            margin-top: 50px;
        }
        .top-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <button id="toggle-dark" class="btn btn-dark" title="Toggle dark mode">üåô</button>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card p-4">
                    <h2 class="mb-4">Trainer Login</h2>
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-info">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                    <form method="post" class="mt-3">
                        {% csrf_token %}
                        {{ form.as_p }}
                        {% if form.errors %}
                            <div class="alert alert-danger">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Dark mode persistence and icon
        function setDarkMode(on) {
            if (on) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'on');
                document.getElementById('toggle-dark').innerText = '‚òÄÔ∏è';
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'off');
                document.getElementById('toggle-dark').innerText = 'üåô';
            }
        }
        // On page load, set dark mode if needed
        if (localStorage.getItem('darkMode') === 'on') {
            setDarkMode(true);
        } else {
            setDarkMode(false);
        }
        document.getElementById('toggle-dark').onclick = function() {
            setDarkMode(!document.body.classList.contains('dark-mode'));
        };
    </script>
</body>
</html>
```

# timetable_app\templates\unauthorized.html

```html
<!DOCTYPE html>
<html>
<head>
    <title>Unauthorized</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="alert alert-danger">
            {{ error }}
        </div>
        <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
    </div>
</body>
</html>
```

# timetable_app\tests.py

```py
from django.test import TestCase

# Create your tests here.

```

# timetable_app\views.py

```py
from .models import Trainer, Utilization
from django.contrib.auth.mixins import LoginRequiredMixin
from django.views.generic import TemplateView
from datetime import datetime
from django.utils import timezone
from django.contrib.auth import logout
from django.contrib import messages
from django.shortcuts import redirect, render
from django.contrib.auth.decorators import login_required
from django.utils.decorators import method_decorator

class CalendarView(LoginRequiredMixin, TemplateView):
    template_name = 'calendar.html'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        try:
            trainer = self.request.user.trainer
            sessions = Utilization.objects.filter(trainer=trainer)
            today = timezone.now().date()
            events = []
            for util in sessions:
                start_dt = timezone.make_aware(datetime.combine(util.session_date, util.start_time))
                end_dt = timezone.make_aware(datetime.combine(util.session_date, util.end_time))
                events.append({
                    'title': util.course_name,
                    'start': start_dt.isoformat(),
                    'end': end_dt.isoformat(),
                    'extendedProps': {
                        'summary': f"{util.course_name} - {util.start_time.strftime('%H:%M')} to {util.end_time.strftime('%H:%M')} at {util.location or 'N/A'}",
                        'highlight': util.session_date == today,
                    }
                })
            context['events'] = events
        except Trainer.DoesNotExist:
            context['error'] = "You are not registered as a trainer."
        return context

def custom_logout(request):
    logout(request)
    messages.info(request, "You are logged out.")
    return redirect('login')

@login_required
def admin_schedule(request):
    if not request.user.is_superuser:
        return render(request, 'timetable_app/unauthorized.html', {'error': "You must be an admin."})
    utilizations = Utilization.objects.all()
    today = timezone.now().date()
    events = [
        {
            'title': util.course_name,
            'start': timezone.make_aware(datetime.combine(util.session_date, util.start_time)).isoformat(),
            'end': timezone.make_aware(datetime.combine(util.session_date, util.end_time)).isoformat(),
            'extendedProps': {
                'summary': f"{util.course_name} - {util.start_time.strftime('%H:%M')} to {util.end_time.strftime('%H:%M')} at {util.location or 'N/A'} (Trainer: {util.trainer.name})",
                'highlight': util.session_date == today,
            }
        }
        for util in utilizations
    ]
    return render(request, 'calendar.html', {'events': events, 'error': None})
```

# trainer_timetable\__init__.py

```py

```

# trainer_timetable\asgi.py

```py
"""
ASGI config for trainer_timetable project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'trainer_timetable.settings')

application = get_asgi_application()

```

# trainer_timetable\settings.py

```py
"""
Django settings for trainer_timetable project.

Generated by 'django-admin startproject' using Django 5.2.1.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-4_mfo0#nc%_v4!dp(9d=4ia$u-5jlof88fmx7u-8!!qfuhofmo'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'timetable_app',  # Custom app for managing timetables
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'trainer_timetable.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'trainer_timetable.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
LOGIN_REDIRECT_URL = '/calendar/'
AUTH_USER_MODEL = 'timetable_app.Member'
```

# trainer_timetable\urls.py

```py
"""
URL configuration for trainer_timetable project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from django.contrib.auth.views import LoginView
from timetable_app.views import CalendarView, custom_logout, admin_schedule
from django.shortcuts import redirect

urlpatterns = [
    path('admin/', admin.site.urls),
    path('login/', LoginView.as_view(template_name='login.html'), name='login'),
    path('logout/', custom_logout, name='logout'),
    path('calendar/', CalendarView.as_view(), name='calendar'),
    path('admin-schedule/', admin_schedule, name='admin_schedule'),  # <-- Add this line
    path('', lambda request: redirect('calendar/')),
    path('accounts/login/', LoginView.as_view(template_name='login.html')),
]

```

# trainer_timetable\wsgi.py

```py
"""
WSGI config for trainer_timetable project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'trainer_timetable.settings')

application = get_wsgi_application()

```

